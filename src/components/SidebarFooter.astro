---
import jwt from "jsonwebtoken";
import { JWT_SECRET } from "~/env";
import { LogOut, User } from "lucide-react";

interface Props {
  showDebug?: boolean;
}

const { showDebug = false } = Astro.props;

const token = Astro.cookies.get("token")?.value;
let user = null;
let userName = "Usuario";

if (token) {
  try {
    user = jwt.verify(token, JWT_SECRET);

    // Obtener nombre del JWT si est√° disponible
    if (user) {
      userName = user.nombres || user.name || user.username || "Usuario";
    }
  } catch (err) {
    user = null;
  }
}
---

<div class="p-4 border-t border-gray-200 flex-shrink-0">
  <div class="flex items-center justify-between">
    <div class="flex items-center gap-2">
      <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center">
        <User className="w-4 h-4 text-gray-600" />
      </div>
      {showDebug ? (
        <span class="text-sm text-gray-600">{userName} | {user?.nombres || 'sin nombres'} | {user?.username}</span>
      ) : (
        <span class="text-sm text-gray-600">{userName}</span>
      )}
    </div>
    <a href="/login" class="text-sm text-gray-500 hover:text-accent transition-colors flex items-center gap-1">
      <LogOut className="w-4 h-4" />
      Salir
    </a>
  </div>
</div>
