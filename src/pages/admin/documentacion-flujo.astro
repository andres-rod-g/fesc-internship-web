---
import AdminLayout from "~/layouts/AdminLayout.astro";
import DocumentacionFlujoSelector from "~/components/admin/DocumentacionFlujoSelector.jsx";
import jwt from "jsonwebtoken";
import { JWT_SECRET } from "~/env";

const token = Astro.cookies.get("token")?.value;
let user = null;
if (token) {
  try {
    user = jwt.verify(token, JWT_SECRET);
  } catch (err) {
    console.error("Error al verificar el token:", err);
    user = null;
  }
}

if (!user) {
  return Astro.redirect("/login");
}

if (!["admin", "registro_control", "director"].includes(user.role)) {
  return Astro.redirect("/admin/dashboard");
}
---

<AdminLayout title="DocumentaciÃ³n del Flujo | FESC">
  <DocumentacionFlujoSelector client:load />
</AdminLayout>
